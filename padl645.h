#ifndef PADL645_H
#define PADL645_H

#include "potocolbase.h"
#include "analytype.h"

class PAdl645 :public PotocolBase
{
public:
    PAdl645();
public:
    enum eDl645Type{
        eDL645_07,eDL645_97
    };
    struct sDl645Tag{
        quint8 t3;      //tag3
        quint8 t2[2];   //tag2 范围
        quint8 t1[2];   //tag1 范围
        quint8 t0[2];   //tag0 范围
        quint8 sec;
        quint8 dlen;    //数据长度或者 表中数据结构长度。
        quint8 dtype;   //数据类型
    };

    bool analypPotocol(const QByteArray &in,QByteArray &out,const QByteArray &m_reqCmd) Q_DECL_OVERRIDE;
    bool createCmd(QByteArray &outcmd, const QString &adrStr, const qint32 dataTag);
    bool createDataTemplate(QList<sTemplate> &m_listTemplate,const qint32 dataTag);
    void setDl645Type(eDl645Type type) {m_dl645Type=type;}

private:
    eDl645Type m_dl645Type;

};

#define DL64597MAXTAG 101
const PAdl645::sDl645Tag dl64597tag[DL64597MAXTAG] = {
    { 9, { 0, 0 }, { 1, 2 }, { 0, 0xe }, 1, 4, eZbcdP2 },
    { 9, { 0, 0 }, { 1, 2 }, { 0x0f, 0x0f }, 15, 4, eZbcdP2 },
    { 9, { 1, 1 }, { 1, 6 }, { 0, 0xe }, 1, 4, eZbcdP2 },
    { 9, { 1, 1 }, { 1, 6 }, { 0x0f, 0x0f }, 15, 4, eZbcdP2 },
    { 9, { 4, 4 }, { 1, 2 }, { 0, 0xe }, 1, 4, eZbcdP2 },
    { 9, { 4, 4 }, { 1, 2 }, { 0x0f, 0x0f }, 15, 4, eZbcdP2 },
    { 9, { 5, 5 }, { 1, 6 }, { 0, 0xe }, 1, 4, eZbcdP2 },
    { 9, { 5, 5 }, { 1, 6 }, { 0x0f, 0x0f }, 15, 4, eZbcdP2 },
    { 9, { 8, 8 }, { 1, 2 }, { 0, 0xe }, 1, 4, eZbcdP2 },
    { 9, { 8, 8 }, { 1, 2 }, { 0x0f, 0x0f }, 15, 4, eZbcdP2 },
    { 9, { 9, 9 }, { 1, 6 }, { 0, 0xe }, 1, 4, eZbcdP2 },
    { 9, { 9, 9 }, { 1, 6 }, { 0x0f, 0x0f }, 15, 4, eZbcdP2 },
    { 0xa, { 0, 0 }, { 1, 2 }, { 0, 0xe }, 1, 3, eZbcdP4 },
    { 0xa, { 0, 0 }, { 1, 2 }, {  0x0f, 0x0f }, 15, 3, eZbcdP4 },
    { 0xa, { 1, 1 }, { 1, 6 }, { 0, 0xe }, 1, 3, eZbcdP4 },
    { 0xa, { 1, 1 }, { 1, 6 }, {  0x0f, 0x0f }, 15, 3, eZbcdP4 },
    { 0xa, { 4, 4 }, { 1, 2 }, { 0, 0xe }, 1, 3, eZbcdP4 },
    { 0xa, { 4, 4 }, { 1, 2 }, {  0x0f, 0x0f }, 15, 3, eZbcdP4 },
    { 0xa, { 5, 5 }, { 1, 6 }, { 0, 0xe }, 1, 3, eZbcdP4 },
    { 0xa, { 5, 5 }, { 1, 6 }, {  0x0f, 0x0f }, 15, 3, eZbcdP4 },
    { 0xa, { 8, 8 }, { 1, 2 }, { 0, 0xe }, 1, 3, eZbcdP4 },
    { 0xa, { 8, 8 }, { 1, 2 }, {  0x0f, 0x0f }, 15, 3, eZbcdP4 },
    { 0xa, { 9, 9 }, { 1, 6 }, { 0, 0xe }, 1, 3, eZbcdP4 },
    { 0xa, { 9, 9 }, { 1, 6 }, {  0x0f, 0x0f }, 15, 3, eZbcdP4 },

    { 0xb, { 0, 0 }, { 1, 2 }, { 0, 0xe }, 1, 4, eZbcd },
    { 0xb, { 0, 0 }, { 1, 2 }, { 0x0f, 0x0f }, 15, 4, eZbcd },
    { 0xb, { 1, 1 }, { 1, 6 }, { 0, 0xe }, 1, 4, eZbcd },
    { 0xb, { 1, 1 }, { 1, 6 }, { 0x0f, 0x0f }, 15, 4, eZbcd },
    { 0xb, { 4, 4 }, { 1, 2 }, { 0, 0xe }, 1, 4, eZbcd },
    { 0xb, { 4, 4 }, { 1, 2 }, { 0x0f, 0x0f }, 15, 4, eZbcd },
    { 0xb, { 5, 5 }, { 1, 6 }, { 0, 0xe }, 1, 4, eZbcd },
    { 0xb, { 5, 5 }, { 1, 6 }, { 0x0f, 0x0f }, 15, 4, eZbcd },
    { 0xb, { 8, 8 }, { 1, 2 }, { 0, 0xe }, 1, 4, eZbcd },
    { 0xb, { 8, 8 }, { 1, 2 }, { 0x0f, 0x0f }, 15, 4, eZbcd },
    { 0xb, { 9, 9 }, { 1, 6 }, { 0, 0xe }, 1, 4, eZbcd },
    { 0xb, { 9, 9 }, { 1, 6 }, { 0x0f, 0x0f }, 15, 4, eZbcd },

    { 0xb, { 2, 2 }, { 1, 1 }, { 0, 1 }, 1, 4, eZbcd },
    { 0xb, { 2, 2 }, { 1, 1 }, { 2, 3 }, 1, 2, eZbcd },
    { 0xb, { 2, 2 }, { 1, 1 }, { 4, 4 }, 1, 3, eZbcd },
    { 0xb, { 3, 3 }, { 1, 1 }, { 0, 3 }, 1, 2, eZbcd },
    { 0xb, { 3, 3 }, { 2, 2 }, { 0, 3 }, 1, 3, eZbcd },
    { 0xb, { 3, 3 }, { 3, 4 }, { 0, 3 }, 1, 4, eZbcd },
    { 0xb, { 6, 6 }, { 1, 1 }, { 1, 3 }, 1, 2, eZbcd },
    { 0xb, { 6, 6 }, { 2, 2 }, { 1, 3 }, 1, 2, eZbcdP2 },
    { 0xb, { 6, 6 }, { 3, 3 }, { 0, 3 }, 1, 3, eZbcdP4 },
    { 0xb, { 6, 6 }, { 3, 3 }, { 4, 5 }, 1, 2, eZbcdP2 },
    { 0xb, { 6, 6 }, { 4, 4 }, { 0, 3 }, 1, 2, eZbcdP2 },
    { 0xb, { 6, 6 }, { 5, 5 }, { 0, 3 }, 1, 2, eZbcdP3 },

    { 0xc, { 0, 0 }, { 1, 1 }, { 0, 0 }, 1, 4, eZbcd },
    { 0xc, { 0, 0 }, { 1, 1 }, { 1, 1 }, 1, 3, eZbcd },
    { 0xc, { 0, 0 }, { 2, 2 }, { 0, 2 }, 1, 1, eZbcd },
    { 0xc, { 0, 0 }, { 3, 3 }, { 0, 1 }, 1, 3, eZbcd },
    { 0xc, { 0, 0 }, { 3, 3 }, { 2, 4 }, 1, 6, eZbcd },
    { 0xc, { 1, 1 }, { 1, 1 }, { 1, 6 }, 1, 1, eZbcd },
    { 0xc, { 1, 1 }, { 1, 1 }, { 7, 7 }, 1, 2, eZbcd },
    { 0xc, { 1, 1 }, { 1, 1 }, { 8, 8 }, 1, 1, eZbcd },
    { 0xc, { 1, 1 }, { 1, 1 }, { 9, 0x0a }, 1, 4, eZbcdP1 },

    { 0xc, { 2, 2 }, { 1, 1 }, { 1, 1 }, 1, 2, eZbcd },
    { 0xc, { 2, 2 }, { 1, 1 }, { 2, 2 }, 1, 4, eZbcd },

    { 0xc, { 3, 3 }, { 1, 1 }, { 0, 4 }, 1, 1, eZbcd },
    { 0xc, { 3, 3 }, { 2, 0x0A }, { 1, 0xa }, 1, 3, eZbcd },
    { 0xc, { 4, 4 }, { 1, 1 }, { 1, 0x0a }, 1, 3, eZbcd },

    { 0xc, { 4, 4 }, { 1, 1 }, { 0x0e, 0x0e }, 1, 1, eZbcd },
    { 0xc, { 5, 5 }, { 1, 1 }, { 0, 0 }, 1, 4, eZbcd },
    { 0xc, { 5, 5 }, { 1, 1 }, { 1, 1 }, 1, 2, eZbcd },
};


#define DL64507MAXTAG 101
const PAdl645::sDl645Tag dl64507tag[DL64507MAXTAG]={
    {0,{0,0},{0,0x3f},{0,0x0c},1,4,eZbcdP2N},     //组合 有符合位
    {0,{0,0},{0xFF,0xFF},{0,0x0c},64,4,eZbcdP2N},
    {0,{0,0},{0,0x3f},{0xFF,0xFF},13,4,eZbcdP2N},
    {0,{0x01,0x02},{0,0x3f},{0,0x0c},1,4,eZbcdP2},
    {0,{1,2},{0xFF,0xFF},{0,0x0c},64,4,eZbcdP2},
    {0,{1,2},{0,0x3f},{0xFF,0xFF},13,4,eZbcdP2},
    {0,{0x03,0x04},{0,0x3f},{0,0x0c},1,4,eZbcdP2N},//组合 有符合位
    {0,{3,4},{0xFF,0xFF},{0,0x0c},64,4,eZbcdP2N},
    {0,{3,4},{0,0x3f},{0xFF,0xFF},13,4,eZbcdP2N},
    {0,{0x05,0x0a},{0,0x3f},{0,0x0c},1,4,eZbcdP2},
    {0,{0x05,0x0a},{0xFF,0xFF},{0,0x0c},64,4,eZbcdP2},
    {0,{0x05,0x0a},{0,0x3f},{0xFF,0xFF},13,4,eZbcdP2},
    {0,{0x80,0x86},{0,0},{0,0x0c},1,4,eZbcdP2},
    {0,{0x15,0x16},{0,0},{0,0x0c},1,4,eZbcdP2},
    {0,{0x17,0x18},{0,0},{0,0x0c},1,4,eZbcdP2N},//组合 有符合位
    {0,{0x18,0x1E},{0,0},{0,0x0c},1,4,eZbcdP2},
    {0,{0x94,0x9A},{0,0},{0,0x0c},1,4,eZbcdP2},
    {0,{0x29,0x2A},{0,0},{0,0x0c},1,4,eZbcdP2},
    {0,{0x2B,0x2D},{0,0},{0,0x0c},1,4,eZbcdP2N},//组合 有符合位
    {0,{0x2D,0x32},{0,0},{0,0x0c},1,4,eZbcdP2},
    {0,{0xA8,0xAE},{0,0},{0,0x0c},1,4,eZbcdP2},
    {0,{0x3D,0x4E},{0,0},{0,0x0c},1,4,eZbcdP2},
    {0,{0x3F,0x40},{0,0},{0,0x0c},1,4,eZbcdP2N},//组合 有符合位
    {0,{0x41,0x46},{0,0},{0,0x0c},1,4,eZbcdP2},
    {0,{0xBC,0xC2},{0,0},{0,0x0c},1,4,eZbcdP2},
    //1
    {1,{0,0x02},{0,0x3f},{0,0x0c},1,8,eT0},
    {1,{0,0x02},{0xFF,0xFF},{0,0x0c},64,8,eT0},
    {1,{0,0x02},{0,0x3f},{0xFF,0xFF},13,8,eT0},

    {1,{0x03,0x04},{0,0x3f},{0,0x0c},1,8,eT0N},//组合 有符合位
    {1,{0x03,0x04},{0xFF,0xFF},{0,0x0c},64,8,eT0N},
    {1,{0x03,0x04},{0,0x3f},{0xFF,0xFF},13,8,eT0N},

    {1,{0x05,0x0a},{0,0x3f},{0,0x0c},1,8,eT0},
    {1,{0x05,0x0a},{0xFF,0xFF},{0,0x0c},64,8,eT0},
     {1,{0x05,0x0a},{0,0x3f},{0xFF,0xFF},13,8,eT0},

    {1,{0x15,0x16},{0,0},{0,0x0c},1,8,eT0},
    {1,{0x15,0x16},{0,0x3f},{0xFF,0xFF},13,8,eT0},
    {1,{0x17,0x18},{0,0},{0,0x0c},1,8,eT0N},//组合 有符合位
    {1,{0x17,0x18},{0,0x3f},{0xFF,0xFF},13,8,eT0N},
    {1,{0x18,0x1E},{0,0},{0,0x0c},1,8,eT0},
    {1,{0x18,0x1E},{0,0x3f},{0xFF,0xFF},13,8,eT0},

    {1,{0x29,0x2A},{0,0},{0,0x0c},1,8,eT0},
    {1,{0x29,0x2A},{0,0x3f},{0xFF,0xFF},13,8,eT0},
    {1,{0x2B,0x2C},{0,0},{0,0x0c},1,8,eT0N}, //组合 有符合位
    {1,{0x2B,0x2C},{0,0x3f},{0xFF,0xFF},13,8,eT0N},
    {1,{0x2D,0x32},{0,0},{0,0x0c},1,8,eT0},
    {1,{0x2D,0x32},{0,0x3f},{0xFF,0xFF},13,8,eT0},

    {1,{0x3D,0x3E},{0,0},{0,0x0c},1,8,eT0},
    {1,{0x3D,0x3E},{0,0x3f},{0xFF,0xFF},13,8,eT0},
    {1,{0x3F,0x40},{0,0},{0,0x0c},1,8,eT0N},
    {1,{0x3F,0x40},{0,0x3f},{0xFF,0xFF},13,8,eT0N},
    {1,{0x41,0x46},{0,0},{0,0x0c},1,8,eT0},
    {1,{0x41,0x46},{0,0x3f},{0xFF,0xFF},13,8,eT0},

    //2
    {2,{0x01,0x01},{0x01,0x03},{0,0},1,2,eZbcdP1},
    {2,{0x01,0x01},{0xff,0xff},{0,0},3,2,eZbcdP1},
    {2,{0x02,0x02},{0x00,0x03},{0,0},1,3,eZbcdP3N},   //电流  有符号
    {2,{0x02,0x02},{0xff,0xff},{0,0},4,3,eZbcdP3N},
    {2,{0x03,0x05},{0x00,0x03},{0,0},1,3,eZbcdP4N},   //瞬时功率  有符号
    {2,{0x03,0x05},{0xff,0xff},{0,0},4,3,eZbcdP4N},
    {2,{0x06,0x06},{0x00,0x03},{0,0},1,2,eZbcdP3N},//功率因数  有符号
    {2,{0x06,0x06},{0xff,0xff},{0,0},4,2,eZbcdP3N},//功率因数  有符号
    {2,{0x07,0x09},{0x01,0x03},{0,0},1,2,eZbcdP2},
    {2,{0x07,0x09},{0xff,0xff},{0,0},3,2,eZbcdP2},
    {2,{0x0A,0x0B},{0x01,0x03},{1,0x15},1,2,eZbcdP2},
    {2,{0x0A,0x0B},{0x01,0x03},{0xff,0xff},21,2,eZbcdP2},
    {2,{0x80,0x80},{0,0},{0x01,0x01},1,3,eZbcdP3N},//电流 有符号
    {2,{0x80,0x80},{0,0},{0x02,0x02},1,2,eZbcdP2},
    {2,{0x80,0x80},{0,0},{0x03,0x06},1,3,eZbcdP4N},//需量 有符号
    {2,{0x80,0x80},{0,0},{0x07,0x07},1,2,eZbcdP1N},//温度 有符号
    {2,{0x80,0x80},{0,0},{0x08,0x09},1,2,eZbcdP2},
    {2,{0x80,0x80},{0,0},{0x0A,0x0A},1,4,eZbcd},
    //3
    {3,{0x01,0x04},{0,0},{0,0},1,1,eT1},
    {3,{0x01,0x04},{0x01,0x03},{0x01,0x0A},1,17,eT2},
    {3,{0x05,0x0A},{0,0},{0,0},1,1,eT21},
    {3,{0x05,0x05},{0,0},{0x01,0x01},1,21,eT3},
    {3,{0x06,0x06},{0,0},{0x01,0x0A},1,1,eT4},
    {3,{0x07,0x08},{0,0},{0x01,0x0a},1,2,eT5},
    {3,{0x09,0x0A},{0,0},{0x01,0x0a},1,3,eT6},
    {3,{0x0B,0x0F},{0,0},{0,0},1,1,eT1},
    {3,{0x0B,0x0D},{0x01,0x03},{0x01,0x0a},1,16,eT7},
    {3,{0x0E,0x0F},{0x01,0x03},{0x01,0x0a},1,2,eT5},
    {3,{0x10,0x10},{0x01,0x03},{0x00,0x0C},1,7,eT8},
    {3,{0x11,0x11},{0,0},{0,0},1,3,eZbcd},
    {3,{0x11,0x11},{0,0},{0x01,0x0A},1,1,eT4},
    {3,{0x12,0x12},{0,0},{0,0},1,1,eT21},
    {3,{0x12,0x12},{0x01,0x06},{0x01,0x0a},1,3,eT9},
    {3,{0x30,0x30},{0,0x09},{0,0},1,3,eZbcd},
    {3,{0x30,0x30},{0,0},{0x01,0x0a},1,3,eT10},
    {3,{0x30,0x30},{0x01,0x01},{0x01,0x0a},1,3,eT11},
    {3,{0x30,0x30},{0x02,0x02},{0x01,0x0a},1,34,eT20},
    {3,{0x30,0x30},{0x03,0x03},{0x01,0x0a},1,2,eT12},
    {3,{0x30,0x30},{0x04,0x04},{0x01,0x0a},1,2,eT13},
    {3,{0x30,0x30},{0x05,0x05},{0x01,0x0a},1,3,eT14},
    {3,{0x30,0x30},{0x06,0x06},{0x01,0x0a},1,3,eT15},
    {3,{0x30,0x30},{0x07,0x07},{0x01,0x0a},1,3,eT16},
    {3,{0x30,0x30},{0x08,0x08},{0x01,0x0a},1,254,eT17},
    {3,{0x30,0x30},{0x09,0x09},{0x01,0x0a},1,3,eT16},
    {3,{0x30,0x30},{0x0a,0x0b},{0,0x0a},1,3,eZbcd},
    {3,{0x30,0x30},{0x0C,0x0C},{0x01,0x0a},1,3,eT18},
    {3,{0x30,0x30},{0x0c,0x0d},{0,0},1,3,eZbcd},
    {3,{0x30,0x30},{0x0D,0x0D},{0x01,0x0a},1,2,eT19},
    {3,{0x30,0x30},{0x0e,0x0e},{0,0x0a},1,3,eZbcd}
};

#endif // PADL645_H
